# Nova 三年可落地规划（2026-2028）

> 目标：把 Nova 从“可运行的 Firecracker 函数平台”演进为“可规模化、多租户、安全合规、可观测、可商业化”的 Serverless 产品。

## 0. 规划原则（先定边界）

1. **以 SLO 驱动路线图**：每个阶段都绑定可量化指标（P95 延迟、冷启动率、成功率、单位请求成本）。
2. **控制复杂度增长**：优先增强现有“单区域 + VM 池 + Postgres”路径，避免过早引入过多控制面系统。
3. **先做高性价比能力**：先解决性能、可靠性、账单可观测，再做多区域与生态扩展。
4. **默认多租户安全**：隔离、密钥管理、审计日志、最小权限必须前置，不做“后补式安全”。
5. **所有能力可灰度、可回滚**：基础设施和运行时升级均要求“版本化 + 流量切分 + 快速回退”。

---

## 1. 三年北极星目标与阶段性 KPI

### 2026（Year 1）：平台可用性与性能稳定化

**主题：把内核打稳，形成“生产可托付”的最小闭环。**

- SLO：函数调用成功率 ≥ 99.95%
- 性能：
  - Warm P95 ≤ 80ms（轻量 Python/Node 场景）
  - Cold P95 ≤ 900ms
  - 冷启动占比 ≤ 15%
- 成本：单次调用基础设施成本较基线下降 25%
- 工程：
  - IaC 覆盖率 100%（网络、数据库、控制面、观测）
  - 发布流水线支持蓝绿/金丝雀与一键回滚

### 2027（Year 2）：多租户能力、弹性与商业化能力

**主题：从“能跑”到“能规模化运营”。**

- SLO：成功率 ≥ 99.99%
- 性能：
  - Warm P95 ≤ 60ms
  - Cold P95 ≤ 500ms
  - 突发扩容 10 倍流量，5 分钟内稳定
- 成本：
  - 单次调用成本再降 20%
  - 资源利用率（VM 池）≥ 65%
- 业务：
  - 支持按租户/环境计费、预算告警、配额治理
  - API 网关与事件源（队列/对象存储/定时）产品化

### 2028（Year 3）：区域级高可用与生态平台化

**主题：跨区域可靠性 + Edge/事件生态 + 企业级合规。**

- SLO：关键租户可达 99.995%（多区域容灾）
- 性能：热点函数“近用户执行”路径 P95 再降 30%
- 可靠性：区域故障 RTO ≤ 10 分钟，RPO ≤ 1 分钟（元数据平面）
- 合规：达到企业可采购标准（审计、密钥、数据治理、漏洞闭环）

---

## 2. 分阶段落地计划（按“容易 → 困难”排序）

> 说明：在保证年度目标不变的前提下，实施顺序按“依赖少、改动小、收益快”到“系统性重构、跨区域、高合规”排序。

### 阶段 A（最容易，0-6 个月）：先把可观测与交付能力做扎实

1. 统一可观测基线（Metrics/Logs/Traces）
   - 调用延迟（冷/热）、错误码、启动耗时拆解（VM 启动/代码盘准备/运行时初始化）。
2. 建立压测与回归流水线
   - 标准场景压测（CPU 密集、IO 密集、短函数、长函数），每日自动回归。
3. CI/CD 与回滚机制标准化
   - 控制面与 agent 独立流水线，支持金丝雀、蓝绿和一键回滚。
4. IaC 基础设施模板落地
   - VPC、子网、安全组、Postgres、对象存储、监控组件。

**阶段产物**：SLO 仪表盘、错误预算告警、性能周报、可回滚发布体系。

### 阶段 B（较容易，6-12 个月）：优化冷启动与单区域可靠性

1. 冷启动优化（第一波）
   - VM 池动态预热（按热度/时段），按 runtime 分池。
   - 并行化启动路径，优化 rootfs 缓存命中。
2. 可靠性治理
   - 重试策略矩阵（按错误类型与幂等性）；资源隔离与配额上限。
3. 故障演练常态化
   - Firecracker 异常、DB 抖动、网络抖动注入演练。
4. 审计与链路追踪贯通
   - 请求链路 ID 从入口贯通到 VM 内 agent。

**阶段产物**：冷启动率看板、故障演练脚本、稳定性月报。

### 阶段 C（中等难度，12-24 个月）：多租户与事件驱动产品化

1. 多租户控制面
   - 组织/项目/环境三级隔离，RBAC，API Key 生命周期管理。
2. 配额与治理
   - 并发、QPS、日志保留、存储配额按租户配置。
3. 事件源产品化
   - webhook/队列/定时/对象存储事件统一接入；死信与重放机制。
4. 成本与调度优化
   - Binpack + 热函数亲和；高优先池/低价池分层。
5. DX 升级
   - 本地调试、远程日志 tail、在线 profile、模板市场。

**阶段产物**：可计费、可治理、可运营的多租户平台能力。

### 阶段 D（最困难，24-36 个月）：多区域高可用、Edge 与企业合规

1. 多区域架构
   - 元数据平面跨区复制、函数代码跨区分发、全局流量治理。
2. 区域级容灾
   - 区域故障演练、自动切主、回切、数据一致性校验。
3. Edge + Wasm 双执行栈
   - 低延迟函数在 Edge 先执行，重计算回源中心区。
4. 企业级安全合规
   - KMS/HSM、SBOM、镜像签名、漏洞准入、审计与数据治理。

**阶段产物**：区域级容灾能力、企业可采购的安全合规能力。

### 年度 KPI 对齐关系

- **2026（Year 1）**：覆盖阶段 A + B，重点达成单区域生产可用与冷启动下降。
- **2027（Year 2）**：覆盖阶段 C，重点达成多租户治理与成本优化。
- **2028（Year 3）**：覆盖阶段 D，重点达成多区域与企业级能力。

---

## 3. 技术架构演进建议（结合 Nova 现状）

1. **执行面（Data Plane）**
   - 保持 Firecracker 为主隔离模型，继续做 VM 池和快照恢复优化。
   - 对超短函数与边缘场景引入 Wasm 路径，形成“双执行栈”。

2. **控制面（Control Plane）**
   - 将函数元数据、版本、配额、策略作为独立域服务（可先模块化，再服务化）。
   - API 层和调度层解耦，避免单体演进瓶颈。

3. **事件面（Event Plane）**
   - 统一事件入口与重试/死信能力，避免业务自行实现重复机制。

4. **可观测面（Observability Plane）**
   - 三件套固定：Metrics + Logs + Traces。
   - 每次发布必须产出“性能与错误预算影响报告”。

5. **安全面（Security Plane）**
   - 默认零信任：短期凭证、最小权限、租户边界强校验。
   - Guest/Host 通信协议版本化并签名校验，防止协议漂移与注入。

---

## 4. 组织与流程建设建议

- 团队编制（建议最小可行）：
  - 平台内核（Firecracker/Runtime）
  - 控制面与 API
  - 可观测与 SRE
  - 安全与合规
  - DX 与生态
- 机制：
  - 每季度一次“路线图复盘 + 成本复盘 + SLO 复盘”。
  - 所有新能力要有“弃用路径”和“回滚策略”。

---

## 5. 风险清单与应对

1. **冷启动长期不达标**
   - 应对：热点预测预热 + 快照恢复 + 运行时差异化治理。
2. **多租户噪声干扰**
   - 应对：严格配额 + 优先级队列 + 大租户隔离池。
3. **数据库成为瓶颈**
   - 应对：读写分离、冷热分层、元数据缓存与批量写策略。
4. **成本失控**
   - 应对：建立 FinOps 看板，预算超阈值自动限流/降级。
5. **合规滞后影响商业化**
   - 应对：Year 1 即引入审计日志和密钥治理，不后置。

---

## 6. 90 天启动清单（按“容易 → 困难”排序）

1. 建立 SLO 与错误预算（成功率、P95、冷启动率、成本）。
2. 上线统一可观测（OTel + Prometheus + Grafana）。
3. 落地 Terraform 基础设施模板（开发/预发/生产三套环境）。
4. 构建金丝雀发布与自动回滚流水线。
5. 完成冷启动路径 profiling，给出 Top 5 优化项。
6. 组织第一次故障演练（Firecracker 进程异常 + DB 抖动）。

> 若 90 天清单全部完成，Nova 将具备进入下一阶段性能与可靠性深化优化的基础条件。
